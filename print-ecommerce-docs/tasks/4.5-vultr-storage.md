# Task 4.5: Vultr Storage

## Goal
Archive original uploads to Vultr Object Storage.

## Instructions

### Install AWS SDK (S3-compatible)
```bash
cd backend
npm install @aws-sdk/client-s3
```

### Create Vultr Service in Strapi
Create `backend/src/services/vultr.js`:

```javascript
const { S3Client, PutObjectCommand } = require('@aws-sdk/client-s3');
const fetch = require('node-fetch');

const s3Client = new S3Client({
  region: 'ewr1',
  endpoint: process.env.VULTR_STORAGE_HOSTNAME,
  credentials: {
    accessKeyId: process.env.VULTR_STORAGE_ACCESS_KEY,
    secretAccessKey: process.env.VULTR_STORAGE_SECRET_KEY,
  },
});

module.exports = {
  async archiveFromCloudinary(cloudinaryUrl, filename) {
    // Fetch image from Cloudinary
    const response = await fetch(cloudinaryUrl);
    const buffer = await response.buffer();

    // Upload to Vultr
    const command = new PutObjectCommand({
      Bucket: process.env.VULTR_STORAGE_BUCKET,
      Key: `archive/${Date.now()}-${filename}`,
      Body: buffer,
      ContentType: response.headers.get('content-type'),
    });

    await s3Client.send(command);
    return true;
  },
};
```

### Add Lifecycle Hook
Update `backend/src/api/uploaded-image/content-types/uploaded-image/lifecycles.js`:

```javascript
const vultr = require('../../../../services/vultr');

module.exports = {
  async afterCreate(event) {
    const { result } = event;
    
    // Archive to Vultr in background
    vultr.archiveFromCloudinary(
      result.cloudinary_url,
      result.original_filename
    ).catch(err => strapi.log.error('Archive failed:', err));
  },
};
```

## Acceptance Criteria
- [ ] Images archive to Vultr automatically
- [ ] Original quality preserved
- [ ] Archive runs in background
