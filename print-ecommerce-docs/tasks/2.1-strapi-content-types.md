# Task 2.1: Strapi Content Types

## Goal
Create all content types, components, and relations in Strapi for the e-commerce platform.

## Prerequisites
- Task 1.2 completed
- Strapi running locally

## Instructions

### Step 1: Create Components First

Components are reusable field groups used across content types.

#### ProductOption Component
In Strapi Admin → Content-Type Builder → Create new component:

**Category:** `product`
**Name:** `option`

Fields:
```
- type (Enumeration): size, paper, finish, quantity, custom
- name_en (Text): Required
- name_he (Text)
- values (JSON): Required
- is_required (Boolean): Default true
- sort_order (Integer): Default 0
```

Example values JSON:
```json
[
  {"value": "a4", "label_en": "A4", "label_he": "A4", "price_modifier": 0},
  {"value": "a3", "label_en": "A3", "label_he": "A3", "price_modifier": 10}
]
```

#### PricingTier Component
**Category:** `product`
**Name:** `pricing-tier`

Fields:
```
- min_quantity (Integer): Required
- max_quantity (Integer): Required
- price_per_unit (Decimal): Required
```

#### Address Component
**Category:** `customer`
**Name:** `address`

Fields:
```
- label (Text): "Home", "Office"
- full_name (Text): Required
- street_address (Text): Required
- city (Text): Required
- postal_code (Text): Required
- country (Text): Default "Israel"
- phone (Text)
- is_default (Boolean): Default false
```

#### ShippingRate Component
**Category:** `shipping`
**Name:** `rate`

Fields:
```
- name (Text)
- min_weight (Decimal)
- max_weight (Decimal)
- price (Decimal): Required
```

### Step 2: Create Collection Types

#### Category
```
- slug (UID): Required, based on name_en
- name_en (Text): Required
- name_he (Text)
- description_en (Rich Text)
- description_he (Rich Text)
- image (Media): Single
- parent (Relation): Category has one Category
- products (Relation): Category has many Products
- sort_order (Integer): Default 0
- is_active (Boolean): Default true
- meta_title (Text)
- meta_description (Text)
```

#### Product
```
- slug (UID): Required, based on name_en
- name_en (Text): Required
- name_he (Text)
- description_en (Rich Text)
- description_he (Rich Text)
- short_description_en (Text)
- short_description_he (Text)
- base_price (Decimal): Required
- sale_price (Decimal)
- images (Media): Multiple
- thumbnail (Media): Single
- category (Relation): Product belongs to Category
- options (Component): Repeatable product.option
- pricing_tiers (Component): Repeatable product.pricing-tier
- requires_upload (Boolean): Default false
- min_quantity (Integer): Default 1
- max_quantity (Integer): Default 1000
- is_active (Boolean): Default true
- is_featured (Boolean): Default false
- meta_title (Text)
- meta_description (Text)
- reviews (Relation): Product has many Reviews
```

#### Customer
```
- supabase_id (Text): Required, Unique
- email (Email): Required, Unique
- full_name (Text)
- phone (Text)
- preferred_language (Enumeration): en-US, he
- addresses (Component): Repeatable customer.address
- orders (Relation): Customer has many Orders
- reviews (Relation): Customer has many Reviews
```

#### Order
```
- order_number (Text): Unique (auto-generated via lifecycle)
- customer (Relation): Order belongs to Customer
- status (Enumeration): pending, confirmed, processing, printing, shipped, delivered, cancelled
- items (Relation): Order has many OrderItems
- subtotal (Decimal)
- discount_amount (Decimal): Default 0
- shipping_cost (Decimal): Default 0
- tax_amount (Decimal): Default 0
- total (Decimal)
- coupon (Relation): Order has one Coupon
- coupon_code (Text)
- shipping_address (JSON)
- billing_address (JSON)
- shipping_method (Text)
- tracking_number (Text)
- estimated_delivery (Date)
- payment_status (Enumeration): pending, paid, failed, refunded
- payment_method (Text)
- payment_reference (Text)
- notes (Text)
- admin_notes (Text)
- paid_at (DateTime)
- shipped_at (DateTime)
- delivered_at (DateTime)
```

#### OrderItem
```
- order (Relation): OrderItem belongs to Order
- product (Relation): OrderItem has one Product
- product_snapshot (JSON)
- quantity (Integer)
- unit_price (Decimal)
- total_price (Decimal)
- selected_options (JSON)
- uploaded_images (Relation): OrderItem has many UploadedImages
- download_status (Enumeration): pending, downloaded, printed
- downloaded_at (DateTime)
- downloaded_by (Relation): has one Customer
```

#### UploadedImage
```
- customer (Relation): belongs to Customer
- order_item (Relation): belongs to OrderItem
- cloudinary_public_id (Text): Required
- cloudinary_url (Text): Required
- original_filename (Text)
- file_size (Integer)
- width (Integer)
- height (Integer)
- format (Text)
- transformations (JSON)
- print_ready_url (Text)
- download_count (Integer): Default 0
- last_downloaded_at (DateTime)
```

#### Coupon
```
- code (Text): Required, Unique
- description (Text)
- discount_type (Enumeration): percentage, fixed, free_shipping
- discount_value (Decimal): Required
- minimum_order (Decimal): Default 0
- maximum_discount (Decimal)
- usage_limit (Integer)
- usage_count (Integer): Default 0
- per_user_limit (Integer): Default 1
- valid_from (DateTime)
- valid_until (DateTime)
- applicable_products (Relation): has many Products
- applicable_categories (Relation): has many Categories
- is_active (Boolean): Default true
```

#### Review
```
- customer (Relation): belongs to Customer
- product (Relation): belongs to Product
- rating (Integer): Min 1, Max 5
- title (Text)
- content (Text)
- is_approved (Boolean): Default false
- is_verified_purchase (Boolean): Default false
- helpful_count (Integer): Default 0
```

#### ShippingZone
```
- name (Text)
- regions (JSON)
- rates (Component): Repeatable shipping.rate
- is_active (Boolean): Default true
```

#### Cart
```
- customer (Relation): has one Customer
- session_id (Text)
- items (JSON)
- updated_at (DateTime)
```

### Step 3: Create Single Types

#### Homepage
```
- hero_slides (Component): Repeatable
  - image (Media)
  - headline_en (Text)
  - headline_he (Text)
  - subheadline_en (Text)
  - subheadline_he (Text)
  - cta_text_en (Text)
  - cta_text_he (Text)
  - cta_link (Text)
- featured_products (Relation): has many Products
- featured_categories (Relation): has many Categories
- promotional_blocks (Component): Repeatable
- testimonials (Component): Repeatable
- seo (Component): Single
```

### Step 4: Create Order Lifecycle Hook

Create `backend/src/api/order/content-types/order/lifecycles.js`:

```javascript
module.exports = {
  async beforeCreate(event) {
    const { data } = event.params;

    // Generate order number
    const date = new Date();
    const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');
    const random = Math.random().toString(36).substring(2, 8).toUpperCase();
    data.order_number = `ORD-${dateStr}-${random}`;
  },
};
```

## Files Created
- All content types via Strapi Admin UI
- `backend/src/api/order/content-types/order/lifecycles.js`
- `backend/src/components/*/` (auto-generated)

## Acceptance Criteria
- [ ] All content types visible in Strapi Admin
- [ ] Components can be added to content types
- [ ] Relations work correctly
- [ ] Order number auto-generates
- [ ] Enumerations show correct values
- [ ] JSON fields accept valid JSON
