# Task 4.1: Cloudinary Upload

## Goal
Integrate Cloudinary upload widget for image uploads.

## Instructions

### Install Dependencies
```bash
npm install cloudinary-core
```

### Create Cloudinary Service
Create `frontend/src/services/cloudinary.service.ts`:

```typescript
import { env } from 'src/utils/env';

class CloudinaryService {
  private cloudName = env.cloudinaryCloudName;
  private uploadPreset = env.cloudinaryUploadPreset;

  getUploadUrl(): string {
    return `https://api.cloudinary.com/v1_1/${this.cloudName}/image/upload`;
  }

  getUploadParams(folder: string = 'uploads') {
    return {
      upload_preset: this.uploadPreset,
      folder,
      timestamp: Date.now(),
    };
  }

  buildUrl(publicId: string, transformations: Record<string, any> = {}): string {
    const transforms = Object.entries(transformations)
      .map(([key, value]) => `${key}_${value}`)
      .join(',');
    
    return `https://res.cloudinary.com/${this.cloudName}/image/upload/${transforms}/${publicId}`;
  }
}

export const cloudinaryService = new CloudinaryService();
```

### Create ImageUploader Component
Create `frontend/src/components/upload/ImageUploader.vue`:

```vue
<template>
  <q-uploader
    ref="uploader"
    :factory="uploadFactory"
    :accept="acceptedFormats"
    :max-file-size="maxFileSize"
    :max-files="maxFiles"
    multiple
    @uploaded="onUploaded"
    @failed="onFailed"
    class="full-width"
    :label="$t('upload.dropzone')"
  >
    <template v-slot:header="scope">
      <div class="row no-wrap items-center q-pa-sm">
        <q-btn v-if="scope.canAddFiles" icon="add" dense flat>
          <q-uploader-add-trigger />
        </q-btn>
        <q-spinner v-if="scope.isUploading" class="q-mr-sm" />
        <span>{{ scope.uploadedFiles.length }} / {{ maxFiles }}</span>
      </div>
    </template>
  </q-uploader>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { cloudinaryService } from 'src/services/cloudinary.service';

const emit = defineEmits<{
  uploaded: [result: any];
  failed: [error: any];
}>();

const props = withDefaults(defineProps<{
  maxFiles?: number;
  maxFileSize?: number;
  folder?: string;
}>(), {
  maxFiles: 10,
  maxFileSize: 52428800, // 50MB
  folder: 'customer-uploads',
});

const acceptedFormats = '.jpg,.jpeg,.png,.pdf,.tiff';

const uploadFactory = () => ({
  url: cloudinaryService.getUploadUrl(),
  method: 'POST',
  formFields: Object.entries(cloudinaryService.getUploadParams(props.folder))
    .map(([name, value]) => ({ name, value: String(value) })),
});

const onUploaded = (info: any) => {
  const response = JSON.parse(info.xhr.response);
  emit('uploaded', {
    publicId: response.public_id,
    url: response.secure_url,
    width: response.width,
    height: response.height,
    format: response.format,
    bytes: response.bytes,
  });
};

const onFailed = (info: any) => {
  emit('failed', info);
};
</script>
```

## Acceptance Criteria
- [ ] Files upload to Cloudinary
- [ ] Progress shown during upload
- [ ] Multiple files supported
- [ ] File type validation works
- [ ] Error handling works
