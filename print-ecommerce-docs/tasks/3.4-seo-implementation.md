# Task 3.4: SEO Implementation

## Goal
Implement comprehensive SEO with meta tags, structured data, and sitemap.

## Instructions

### Step 1: Create SEO Composable

Create `frontend/src/composables/useSeo.ts`:

```typescript
import { useMeta } from 'quasar';
import { useI18n } from 'vue-i18n';
import { env } from 'src/utils/env';

interface SeoOptions {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'product' | 'article';
  product?: {
    price: number;
    currency: string;
    availability: 'InStock' | 'OutOfStock';
    rating?: number;
    reviewCount?: number;
  };
}

export function useSeo(options: SeoOptions) {
  const { locale } = useI18n();

  useMeta(() => {
    const meta: any = {
      title: options.title,
      titleTemplate: (title: string) => `${title} | ${env.companyName}`,
      meta: {
        description: {
          name: 'description',
          content: options.description || '',
        },
        // Open Graph
        ogTitle: { property: 'og:title', content: options.title },
        ogDescription: { property: 'og:description', content: options.description || '' },
        ogType: { property: 'og:type', content: options.type || 'website' },
        ogLocale: { property: 'og:locale', content: locale.value === 'he' ? 'he_IL' : 'en_US' },
        ogSiteName: { property: 'og:site_name', content: env.companyName },
        // Twitter
        twitterCard: { name: 'twitter:card', content: 'summary_large_image' },
        twitterTitle: { name: 'twitter:title', content: options.title },
        twitterDescription: { name: 'twitter:description', content: options.description || '' },
      },
      htmlAttr: {
        lang: locale.value,
        dir: locale.value === 'he' ? 'rtl' : 'ltr',
      },
    };

    if (options.image) {
      meta.meta.ogImage = { property: 'og:image', content: options.image };
      meta.meta.twitterImage = { name: 'twitter:image', content: options.image };
    }

    // Product structured data
    if (options.type === 'product' && options.product) {
      meta.script = {
        ldJson: {
          type: 'application/ld+json',
          innerHTML: JSON.stringify({
            '@context': 'https://schema.org',
            '@type': 'Product',
            name: options.title,
            description: options.description,
            image: options.image,
            offers: {
              '@type': 'Offer',
              price: options.product.price,
              priceCurrency: options.product.currency,
              availability: `https://schema.org/${options.product.availability}`,
            },
            ...(options.product.rating && {
              aggregateRating: {
                '@type': 'AggregateRating',
                ratingValue: options.product.rating,
                reviewCount: options.product.reviewCount || 0,
              },
            }),
          }),
        },
      };
    }

    return meta;
  });
}
```

### Step 2: Create Sitemap Generator

Create `frontend/src/utils/sitemap.ts` (for SSR):

```typescript
import { strapiService } from 'src/services/strapi.service';

export async function generateSitemap(baseUrl: string): Promise<string> {
  const [products, categories] = await Promise.all([
    strapiService.getProducts({ pageSize: 1000 }),
    strapiService.getCategories(),
  ]);

  const urls = [
    { loc: baseUrl, priority: '1.0', changefreq: 'daily' },
    { loc: `${baseUrl}/products`, priority: '0.9', changefreq: 'daily' },
  ];

  // Add categories
  categories.data.forEach((cat: any) => {
    urls.push({
      loc: `${baseUrl}/products/category/${cat.attributes.slug}`,
      priority: '0.8',
      changefreq: 'weekly',
    });
  });

  // Add products
  products.data.forEach((product: any) => {
    urls.push({
      loc: `${baseUrl}/products/${product.attributes.slug}`,
      priority: '0.7',
      changefreq: 'weekly',
    });
  });

  const sitemap = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
${urls.map((url) => `  <url>
    <loc>${url.loc}</loc>
    <priority>${url.priority}</priority>
    <changefreq>${url.changefreq}</changefreq>
  </url>`).join('\n')}
</urlset>`;

  return sitemap;
}
```

### Step 3: Create robots.txt

Create `frontend/public/robots.txt`:

```
User-agent: *
Allow: /
Disallow: /profile/
Disallow: /cart/
Disallow: /checkout/
Disallow: /auth/

Sitemap: https://yourdomain.com/sitemap.xml
```

### Step 4: Add SSR Middleware for Sitemap

Create `frontend/src-ssr/middlewares/sitemap.ts`:

```typescript
import { ssrMiddleware } from 'quasar/wrappers';
import { generateSitemap } from 'src/utils/sitemap';

export default ssrMiddleware(async ({ app, resolve }) => {
  app.get('/sitemap.xml', async (req, res) => {
    const baseUrl = process.env.SITE_URL || 'https://yourdomain.com';
    const sitemap = await generateSitemap(baseUrl);
    res.header('Content-Type', 'application/xml');
    res.send(sitemap);
  });
});
```

## Acceptance Criteria
- [ ] Meta tags render in SSR
- [ ] Open Graph tags work (test with Facebook debugger)
- [ ] Product structured data validates (Google Rich Results Test)
- [ ] Sitemap generates dynamically
- [ ] robots.txt accessible
- [ ] Lighthouse SEO score > 90
