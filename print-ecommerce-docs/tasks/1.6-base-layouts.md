# Task 1.6: Base Layouts and Routing

## Goal
Create the base layout components and routing structure for the application.

## Prerequisites
- Tasks 1.1-1.5 completed
- RTL and i18n configured

## Instructions

### Step 1: Create Main Layout

Create `frontend/src/layouts/MainLayout.vue`:

```vue
<template>
  <q-layout view="hHh lpR fFf">
    <!-- Header -->
    <q-header elevated class="bg-primary text-white">
      <q-toolbar>
        <!-- Mobile menu button -->
        <q-btn
          v-if="$q.screen.lt.md"
          flat
          dense
          round
          icon="menu"
          aria-label="Menu"
          @click="toggleLeftDrawer"
        />

        <!-- Logo -->
        <q-toolbar-title>
          <router-link to="/" class="text-white text-decoration-none">
            {{ companyName }}
          </router-link>
        </q-toolbar-title>

        <!-- Desktop Navigation -->
        <div v-if="$q.screen.gt.sm" class="q-gutter-md">
          <q-btn
            flat
            :to="{ name: 'products' }"
            :label="$t('nav.allProducts')"
          />
          <q-btn
            flat
            :to="{ name: 'categories' }"
            :label="$t('nav.categories')"
          />
        </div>

        <q-space />

        <!-- Language Switcher -->
        <LanguageSwitcher />

        <!-- Search -->
        <q-btn flat round icon="search" @click="showSearch = true" />

        <!-- Cart -->
        <q-btn flat round icon="shopping_cart" @click="toggleCart">
          <q-badge v-if="cartCount > 0" color="red" floating>
            {{ cartCount }}
          </q-badge>
        </q-btn>

        <!-- User Menu -->
        <q-btn flat round icon="person">
          <q-menu>
            <q-list style="min-width: 150px">
              <template v-if="isAuthenticated">
                <q-item clickable v-close-popup :to="{ name: 'profile' }">
                  <q-item-section>{{ $t('nav.profile') }}</q-item-section>
                </q-item>
                <q-item clickable v-close-popup :to="{ name: 'orders' }">
                  <q-item-section>{{ $t('nav.orders') }}</q-item-section>
                </q-item>
                <q-separator />
                <q-item clickable v-close-popup @click="handleLogout">
                  <q-item-section>{{ $t('common.logout') }}</q-item-section>
                </q-item>
              </template>
              <template v-else>
                <q-item clickable v-close-popup :to="{ name: 'login' }">
                  <q-item-section>{{ $t('common.login') }}</q-item-section>
                </q-item>
                <q-item clickable v-close-popup :to="{ name: 'register' }">
                  <q-item-section>{{ $t('common.register') }}</q-item-section>
                </q-item>
              </template>
            </q-list>
          </q-menu>
        </q-btn>
      </q-toolbar>

      <!-- Category Navigation Bar (Desktop) -->
      <q-toolbar v-if="$q.screen.gt.sm" inset class="bg-primary-dark">
        <q-tabs align="left" narrow-indicator>
          <q-route-tab
            v-for="category in topCategories"
            :key="category.id"
            :to="`/products/category/${category.slug}`"
            :label="isRtl ? category.name_he : category.name_en"
          />
        </q-tabs>
      </q-toolbar>
    </q-header>

    <!-- Mobile Drawer -->
    <q-drawer
      v-model="leftDrawerOpen"
      :side="isRtl ? 'right' : 'left'"
      bordered
    >
      <q-list>
        <q-item-label header>{{ $t('nav.categories') }}</q-item-label>
        <q-item
          v-for="category in topCategories"
          :key="category.id"
          clickable
          v-close-popup
          :to="`/products/category/${category.slug}`"
        >
          <q-item-section>
            {{ isRtl ? category.name_he : category.name_en }}
          </q-item-section>
        </q-item>
      </q-list>
    </q-drawer>

    <!-- Cart Drawer -->
    <CartDrawer v-model="cartDrawerOpen" />

    <!-- Search Dialog -->
    <SearchDialog v-model="showSearch" />

    <!-- Main Content -->
    <q-page-container>
      <router-view />
    </q-page-container>

    <!-- Footer -->
    <q-footer class="bg-dark text-white q-pa-lg">
      <div class="row q-col-gutter-md">
        <div class="col-12 col-md-4">
          <h6 class="q-mb-md">{{ companyName }}</h6>
          <p class="text-grey-5">{{ $t('footer.about') }}</p>
        </div>
        <div class="col-12 col-md-4">
          <h6 class="q-mb-md">{{ $t('nav.categories') }}</h6>
          <q-list dense>
            <q-item
              v-for="category in topCategories"
              :key="category.id"
              clickable
              :to="`/products/category/${category.slug}`"
            >
              <q-item-section>
                {{ isRtl ? category.name_he : category.name_en }}
              </q-item-section>
            </q-item>
          </q-list>
        </div>
        <div class="col-12 col-md-4">
          <h6 class="q-mb-md">{{ $t('footer.contact') }}</h6>
          <p>
            <q-icon name="email" class="q-mr-sm" />
            info@example.com
          </p>
          <p>
            <q-icon name="phone" class="q-mr-sm" />
            <span class="phone-number">+972-XX-XXX-XXXX</span>
          </p>
        </div>
      </div>
      <q-separator class="q-my-md" dark />
      <div class="row items-center justify-between">
        <div class="col-auto">
          {{ $t('footer.copyright', { year: new Date().getFullYear() }) }}
        </div>
        <div class="col-auto">
          <router-link to="/legal/terms" class="text-white q-mr-md">
            {{ $t('footer.terms') }}
          </router-link>
          <router-link to="/legal/privacy" class="text-white">
            {{ $t('footer.privacy') }}
          </router-link>
        </div>
      </div>
    </q-footer>
  </q-layout>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { useQuasar } from 'quasar';
import { useAuth } from 'src/composables/useAuth';
import { useRtl } from 'src/composables/useRtl';
import { useCartStore } from 'src/stores/cart.store';
import { env } from 'src/utils/env';
import LanguageSwitcher from 'src/components/common/LanguageSwitcher.vue';
import CartDrawer from 'src/components/cart/CartDrawer.vue';
import SearchDialog from 'src/components/common/SearchDialog.vue';

const $q = useQuasar();
const { isAuthenticated, signOut } = useAuth();
const { isRtl } = useRtl();
const cartStore = useCartStore();

const companyName = env.companyName;

const leftDrawerOpen = ref(false);
const cartDrawerOpen = ref(false);
const showSearch = ref(false);

// Placeholder for categories (will be fetched from Strapi)
const topCategories = ref([
  { id: 1, slug: 'business-cards', name_en: 'Business Cards', name_he: 'כרטיסי ביקור' },
  { id: 2, slug: 'flyers', name_en: 'Flyers', name_he: 'פלאיירים' },
  { id: 3, slug: 'posters', name_en: 'Posters', name_he: 'פוסטרים' },
]);

const cartCount = computed(() => cartStore.itemCount);

const toggleLeftDrawer = () => {
  leftDrawerOpen.value = !leftDrawerOpen.value;
};

const toggleCart = () => {
  cartDrawerOpen.value = !cartDrawerOpen.value;
};

const handleLogout = async () => {
  await signOut();
  $q.notify({
    type: 'positive',
    message: 'Logged out successfully',
  });
};
</script>
```

### Step 2: Create Auth Layout

Create `frontend/src/layouts/AuthLayout.vue`:

```vue
<template>
  <q-layout view="hHh lpR fFf">
    <q-page-container>
      <q-page class="flex flex-center bg-grey-2">
        <q-card class="auth-card q-pa-lg" :style="cardStyle">
          <!-- Logo -->
          <div class="text-center q-mb-lg">
            <router-link to="/">
              <h4 class="text-primary q-ma-none">{{ companyName }}</h4>
            </router-link>
          </div>

          <!-- Language Switcher -->
          <div class="text-center q-mb-md">
            <LanguageSwitcher />
          </div>

          <!-- Auth Form Content -->
          <router-view />

          <!-- Back to Home -->
          <div class="text-center q-mt-lg">
            <router-link to="/" class="text-grey-7">
              {{ $t('common.back') }} {{ $t('common.home') }}
            </router-link>
          </div>
        </q-card>
      </q-page>
    </q-page-container>
  </q-layout>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useQuasar } from 'quasar';
import { env } from 'src/utils/env';
import LanguageSwitcher from 'src/components/common/LanguageSwitcher.vue';

const $q = useQuasar();
const companyName = env.companyName;

const cardStyle = computed(() => ({
  width: $q.screen.gt.sm ? '400px' : '100%',
  maxWidth: '100%',
}));
</script>

<style scoped lang="scss">
.auth-card {
  border-radius: 8px;
}
</style>
```

### Step 3: Create Checkout Layout

Create `frontend/src/layouts/CheckoutLayout.vue`:

```vue
<template>
  <q-layout view="hHh lpR fFf">
    <!-- Minimal Header -->
    <q-header elevated class="bg-white text-dark">
      <q-toolbar>
        <router-link to="/" class="text-dark text-decoration-none">
          <h5 class="q-ma-none">{{ companyName }}</h5>
        </router-link>

        <q-space />

        <span class="text-grey-7">
          <q-icon name="lock" class="q-mr-sm" />
          {{ $t('checkout.secureCheckout') }}
        </span>
      </q-toolbar>

      <!-- Progress Steps -->
      <q-linear-progress
        :value="progress"
        color="primary"
        class="q-mt-sm"
      />
    </q-header>

    <q-page-container>
      <router-view />
    </q-page-container>
  </q-layout>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useRoute } from 'vue-router';
import { env } from 'src/utils/env';

const route = useRoute();
const companyName = env.companyName;

const progress = computed(() => {
  const steps = ['checkout', 'payment', 'confirmation'];
  const currentStep = route.name as string;
  const index = steps.findIndex((s) => currentStep.includes(s));
  return ((index + 1) / steps.length) * 100 / 100;
});
</script>
```

### Step 4: Create Language Switcher Component

Create `frontend/src/components/common/LanguageSwitcher.vue`:

```vue
<template>
  <q-btn-dropdown
    flat
    :label="currentLabel"
    dropdown-icon="expand_more"
  >
    <q-list>
      <q-item
        v-for="lang in languages"
        :key="lang.value"
        clickable
        v-close-popup
        @click="setLocale(lang.value)"
        :active="locale === lang.value"
      >
        <q-item-section>{{ lang.label }}</q-item-section>
      </q-item>
    </q-list>
  </q-btn-dropdown>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useRtl } from 'src/composables/useRtl';

const { locale, setLocale } = useRtl();

const languages = [
  { value: 'he', label: 'עברית' },
  { value: 'en-US', label: 'English' },
];

const currentLabel = computed(() => {
  const lang = languages.find((l) => l.value === locale.value);
  return lang?.label || 'Language';
});
</script>
```

### Step 5: Create Routes Configuration

Create `frontend/src/router/routes.ts`:

```typescript
import type { RouteRecordRaw } from 'vue-router';

const routes: RouteRecordRaw[] = [
  // Main Layout Routes
  {
    path: '/',
    component: () => import('layouts/MainLayout.vue'),
    children: [
      {
        path: '',
        name: 'home',
        component: () => import('pages/IndexPage.vue'),
      },
      // Products
      {
        path: 'products',
        name: 'products',
        component: () => import('pages/products/IndexPage.vue'),
      },
      {
        path: 'products/category/:slug',
        name: 'category',
        component: () => import('pages/products/CategoryPage.vue'),
      },
      {
        path: 'products/:slug',
        name: 'product',
        component: () => import('pages/products/ProductPage.vue'),
      },
      // Upload
      {
        path: 'upload',
        name: 'upload',
        component: () => import('pages/upload/IndexPage.vue'),
        meta: { requiresAuth: false }, // Can upload as guest
      },
      {
        path: 'upload/editor',
        name: 'upload-editor',
        component: () => import('pages/upload/EditorPage.vue'),
      },
      // Cart
      {
        path: 'cart',
        name: 'cart',
        component: () => import('pages/cart/IndexPage.vue'),
      },
      // Profile (requires auth)
      {
        path: 'profile',
        name: 'profile',
        component: () => import('pages/profile/IndexPage.vue'),
        meta: { requiresAuth: true },
      },
      {
        path: 'profile/orders',
        name: 'orders',
        component: () => import('pages/profile/OrdersPage.vue'),
        meta: { requiresAuth: true },
      },
      {
        path: 'profile/orders/:id',
        name: 'order-detail',
        component: () => import('pages/profile/OrderDetailPage.vue'),
        meta: { requiresAuth: true },
      },
      {
        path: 'profile/settings',
        name: 'settings',
        component: () => import('pages/profile/SettingsPage.vue'),
        meta: { requiresAuth: true },
      },
      // Legal
      {
        path: 'legal/terms',
        name: 'terms',
        component: () => import('pages/legal/TermsPage.vue'),
      },
      {
        path: 'legal/privacy',
        name: 'privacy',
        component: () => import('pages/legal/PrivacyPage.vue'),
      },
    ],
  },

  // Auth Layout Routes
  {
    path: '/auth',
    component: () => import('layouts/AuthLayout.vue'),
    children: [
      {
        path: 'login',
        name: 'login',
        component: () => import('pages/auth/LoginPage.vue'),
      },
      {
        path: 'register',
        name: 'register',
        component: () => import('pages/auth/RegisterPage.vue'),
      },
      {
        path: 'callback',
        name: 'auth-callback',
        component: () => import('pages/auth/CallbackPage.vue'),
      },
      {
        path: 'forgot-password',
        name: 'forgot-password',
        component: () => import('pages/auth/ForgotPasswordPage.vue'),
      },
      {
        path: 'reset-password',
        name: 'reset-password',
        component: () => import('pages/auth/ResetPasswordPage.vue'),
      },
    ],
  },

  // Checkout Layout Routes
  {
    path: '/checkout',
    component: () => import('layouts/CheckoutLayout.vue'),
    children: [
      {
        path: '',
        name: 'checkout',
        component: () => import('pages/checkout/IndexPage.vue'),
      },
      {
        path: 'payment',
        name: 'checkout-payment',
        component: () => import('pages/checkout/PaymentPage.vue'),
      },
      {
        path: 'confirmation',
        name: 'checkout-confirmation',
        component: () => import('pages/checkout/ConfirmationPage.vue'),
      },
    ],
  },

  // 404 Page
  {
    path: '/:catchAll(.*)*',
    component: () => import('pages/ErrorNotFound.vue'),
  },
];

export default routes;
```

### Step 6: Create Router Index with Auth Guard

Update `frontend/src/router/index.ts`:

```typescript
import { route } from 'quasar/wrappers';
import {
  createMemoryHistory,
  createRouter,
  createWebHashHistory,
  createWebHistory,
} from 'vue-router';
import routes from './routes';
import { useAuth } from 'src/composables/useAuth';

export default route(function (/* { store, ssrContext } */) {
  const createHistory = process.env.SERVER
    ? createMemoryHistory
    : process.env.VUE_ROUTER_MODE === 'history'
    ? createWebHistory
    : createWebHashHistory;

  const Router = createRouter({
    scrollBehavior: () => ({ left: 0, top: 0 }),
    routes,
    history: createHistory(process.env.VUE_ROUTER_BASE),
  });

  // Auth guard
  Router.beforeEach(async (to, from, next) => {
    const { isAuthenticated, initAuth } = useAuth();

    // Initialize auth if not already done
    if (!isAuthenticated.value) {
      await initAuth();
    }

    // Check if route requires auth
    if (to.meta.requiresAuth && !isAuthenticated.value) {
      // Store intended destination
      if (typeof sessionStorage !== 'undefined') {
        sessionStorage.setItem('authRedirect', to.fullPath);
      }
      next({ name: 'login' });
      return;
    }

    // Redirect logged-in users away from auth pages
    if (to.path.startsWith('/auth/') && isAuthenticated.value) {
      if (to.name !== 'auth-callback') {
        next({ name: 'home' });
        return;
      }
    }

    next();
  });

  return Router;
});
```

### Step 7: Create Placeholder Page Components

Create `frontend/src/pages/IndexPage.vue`:

```vue
<template>
  <q-page class="q-pa-md">
    <h1>{{ $t('common.home') }}</h1>
    <p>Welcome to {{ companyName }}</p>
  </q-page>
</template>

<script setup lang="ts">
import { env } from 'src/utils/env';
const companyName = env.companyName;
</script>
```

Create `frontend/src/pages/ErrorNotFound.vue`:

```vue
<template>
  <q-page class="flex flex-center">
    <div class="text-center">
      <h1 class="text-h1 text-primary">404</h1>
      <p class="text-h6 text-grey-7">Page not found</p>
      <q-btn
        color="primary"
        :label="$t('common.home')"
        :to="{ name: 'home' }"
        class="q-mt-md"
      />
    </div>
  </q-page>
</template>
```

## Files Created
- `frontend/src/layouts/MainLayout.vue`
- `frontend/src/layouts/AuthLayout.vue`
- `frontend/src/layouts/CheckoutLayout.vue`
- `frontend/src/components/common/LanguageSwitcher.vue`
- `frontend/src/router/routes.ts`
- `frontend/src/router/index.ts`
- `frontend/src/pages/IndexPage.vue`
- `frontend/src/pages/ErrorNotFound.vue`

## Acceptance Criteria
- [ ] MainLayout displays header, footer, and content
- [ ] Mobile drawer opens on menu click
- [ ] Language switcher changes locale
- [ ] RTL layout flips correctly for Hebrew
- [ ] AuthLayout centers auth forms
- [ ] CheckoutLayout shows minimal header
- [ ] Routes navigate correctly
- [ ] Auth guard redirects unauthenticated users
- [ ] 404 page displays for unknown routes
