# Task 5.1: Cart Functionality

## Goal
Build shopping cart with persistence for guests and logged-in users.

## Instructions

### Create Cart Store
Create `frontend/src/stores/cart.store.ts`:

```typescript
import { defineStore } from 'pinia';
import { useLocalStorage } from '@vueuse/core';
import { computed } from 'vue';

interface CartItem {
  id: string;
  productId: number;
  product: any;
  quantity: number;
  selectedOptions: Record<string, string>;
  unitPrice: number;
  uploadedImages: any[];
}

export const useCartStore = defineStore('cart', () => {
  const items = useLocalStorage<CartItem[]>('cart-items', []);

  const itemCount = computed(() => 
    items.value.reduce((sum, item) => sum + item.quantity, 0)
  );

  const subtotal = computed(() =>
    items.value.reduce((sum, item) => sum + item.unitPrice * item.quantity, 0)
  );

  const addItem = (product: any, quantity: number, options: Record<string, string>) => {
    const id = `${product.id}-${JSON.stringify(options)}`;
    const existing = items.value.find(item => item.id === id);

    if (existing) {
      existing.quantity += quantity;
    } else {
      items.value.push({
        id,
        productId: product.id,
        product,
        quantity,
        selectedOptions: options,
        unitPrice: calculatePrice(product, options),
        uploadedImages: [],
      });
    }
  };

  const updateQuantity = (id: string, quantity: number) => {
    const item = items.value.find(i => i.id === id);
    if (item) {
      item.quantity = Math.max(1, quantity);
    }
  };

  const removeItem = (id: string) => {
    const index = items.value.findIndex(i => i.id === id);
    if (index > -1) items.value.splice(index, 1);
  };

  const clearCart = () => {
    items.value = [];
  };

  const calculatePrice = (product: any, options: Record<string, string>) => {
    let price = product.attributes?.sale_price || product.attributes?.base_price || 0;
    // Add option modifiers
    return price;
  };

  return {
    items,
    itemCount,
    subtotal,
    addItem,
    updateQuantity,
    removeItem,
    clearCart,
  };
});
```

### Create Cart Drawer Component
Create `frontend/src/components/cart/CartDrawer.vue`:

```vue
<template>
  <q-drawer v-model="show" :side="isRtl ? 'left' : 'right'" :width="400" bordered>
    <q-toolbar class="bg-primary text-white">
      <q-toolbar-title>{{ $t('cart.yourCart') }}</q-toolbar-title>
      <q-btn flat round icon="close" @click="show = false" />
    </q-toolbar>

    <q-scroll-area class="fit" style="height: calc(100% - 150px)">
      <q-list v-if="cartStore.items.length" separator>
        <CartItem
          v-for="item in cartStore.items"
          :key="item.id"
          :item="item"
          @update:quantity="cartStore.updateQuantity(item.id, $event)"
          @remove="cartStore.removeItem(item.id)"
        />
      </q-list>
      
      <div v-else class="text-center q-pa-xl">
        <q-icon name="shopping_cart" size="64px" color="grey-4" />
        <p class="text-grey-6 q-mt-md">{{ $t('cart.empty') }}</p>
      </div>
    </q-scroll-area>

    <div class="absolute-bottom q-pa-md bg-white">
      <div class="row justify-between q-mb-md">
        <span class="text-subtitle1">{{ $t('cart.subtotal') }}</span>
        <span class="text-h6 price-display">{{ formatPrice(cartStore.subtotal) }}</span>
      </div>
      <q-btn
        color="primary"
        :label="$t('cart.checkout')"
        class="full-width"
        :to="{ name: 'checkout' }"
        :disable="!cartStore.items.length"
      />
    </div>
  </q-drawer>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useCartStore } from 'src/stores/cart.store';
import { useRtl } from 'src/composables/useRtl';
import { env } from 'src/utils/env';
import CartItem from './CartItem.vue';

const props = defineProps<{ modelValue: boolean }>();
const emit = defineEmits<{ 'update:modelValue': [boolean] }>();

const show = computed({
  get: () => props.modelValue,
  set: (v) => emit('update:modelValue', v),
});

const cartStore = useCartStore();
const { isRtl } = useRtl();

const formatPrice = (price: number) => `${env.currencySymbol}${price.toFixed(2)}`;
</script>
```

## Acceptance Criteria
- [ ] Add to cart works
- [ ] Quantity updates
- [ ] Items removable
- [ ] Cart persists after refresh
- [ ] Subtotal calculates correctly
