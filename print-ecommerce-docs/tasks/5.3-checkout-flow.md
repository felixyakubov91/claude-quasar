# Task 5.3: Checkout Flow

## Goal
Build checkout process with address forms and shipping selection.

## Instructions

### Create Checkout Page
Create `frontend/src/pages/checkout/IndexPage.vue`:

```vue
<template>
  <q-page class="q-pa-md">
    <div class="row q-col-gutter-lg">
      <!-- Checkout Form -->
      <div class="col-12 col-md-8">
        <q-stepper v-model="step" vertical animated>
          <!-- Shipping Address -->
          <q-step :name="1" :title="$t('checkout.shippingAddress')" icon="location_on">
            <ShippingForm v-model="shippingAddress" @next="step = 2" />
          </q-step>

          <!-- Shipping Method -->
          <q-step :name="2" :title="$t('checkout.shippingMethod')" icon="local_shipping">
            <ShippingMethodSelector v-model="shippingMethod" :zones="shippingZones" @next="step = 3" />
          </q-step>

          <!-- Review -->
          <q-step :name="3" :title="$t('checkout.review')" icon="receipt">
            <OrderReview :address="shippingAddress" :method="shippingMethod" :items="cartStore.items" />
            <q-btn color="primary" :label="$t('checkout.proceedToPayment')" class="q-mt-md" @click="proceedToPayment" />
          </q-step>
        </q-stepper>
      </div>

      <!-- Order Summary -->
      <div class="col-12 col-md-4">
        <OrderSummary :items="cartStore.items" :shipping="shippingCost" :discount="discount" />
      </div>
    </div>
  </q-page>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { useCartStore } from 'src/stores/cart.store';
import { useCoupons } from 'src/composables/useCoupons';
import { strapiService } from 'src/services/strapi.service';
import ShippingForm from 'src/components/checkout/ShippingForm.vue';
import ShippingMethodSelector from 'src/components/checkout/ShippingMethodSelector.vue';
import OrderReview from 'src/components/checkout/OrderReview.vue';
import OrderSummary from 'src/components/checkout/OrderSummary.vue';

const router = useRouter();
const cartStore = useCartStore();
const { calculateDiscount } = useCoupons();

const step = ref(1);
const shippingAddress = ref({});
const shippingMethod = ref(null);
const shippingZones = ref([]);

const shippingCost = computed(() => shippingMethod.value?.price || 0);
const discount = computed(() => calculateDiscount());

const proceedToPayment = () => {
  // Save order data to session storage for payment page
  sessionStorage.setItem('checkoutData', JSON.stringify({
    shippingAddress: shippingAddress.value,
    shippingMethod: shippingMethod.value,
  }));
  router.push({ name: 'checkout-payment' });
};

onMounted(async () => {
  shippingZones.value = (await strapiService.getShippingZones()).data;
});
</script>
```

### Create ShippingForm Component
Create `frontend/src/components/checkout/ShippingForm.vue`:

```vue
<template>
  <q-form @submit.prevent="$emit('next')">
    <div class="row q-col-gutter-md">
      <div class="col-12 col-sm-6">
        <q-input v-model="form.full_name" :label="$t('checkout.fullName')" outlined :rules="[required]" />
      </div>
      <div class="col-12 col-sm-6">
        <q-input v-model="form.phone" :label="$t('checkout.phone')" outlined :rules="[required]" />
      </div>
      <div class="col-12">
        <q-input v-model="form.street_address" :label="$t('checkout.address')" outlined :rules="[required]" />
      </div>
      <div class="col-12 col-sm-6">
        <q-input v-model="form.city" :label="$t('checkout.city')" outlined :rules="[required]" />
      </div>
      <div class="col-12 col-sm-6">
        <q-input v-model="form.postal_code" :label="$t('checkout.postalCode')" outlined :rules="[required]" />
      </div>
    </div>
    <q-btn type="submit" color="primary" :label="$t('common.next')" class="q-mt-md" />
  </q-form>
</template>

<script setup lang="ts">
import { reactive, watch } from 'vue';
import { useI18n } from 'vue-i18n';

const props = defineProps<{ modelValue: any }>();
const emit = defineEmits(['update:modelValue', 'next']);
const { t } = useI18n();

const form = reactive({
  full_name: '',
  phone: '',
  street_address: '',
  city: '',
  postal_code: '',
  country: 'Israel',
});

const required = (v: string) => !!v || t('validation.required');

watch(form, () => emit('update:modelValue', { ...form }), { deep: true });
</script>
```

## Acceptance Criteria
- [ ] Multi-step checkout works
- [ ] Address form validates
- [ ] Shipping methods load
- [ ] Order summary updates
- [ ] Proceeds to payment
