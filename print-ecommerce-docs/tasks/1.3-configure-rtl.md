# Task 1.3: Configure RTL Support

## Goal
Set up RTL (Right-to-Left) support for Hebrew language with postcss-rtlcss and vue-i18n.

## Prerequisites
- Task 1.1 completed
- Quasar project initialized

## Instructions

### Step 1: Install Dependencies

```bash
cd frontend
npm install postcss-rtlcss vue-i18n@9 @intlify/unplugin-vue-i18n
```

### Step 2: Configure PostCSS for RTL

Create `frontend/postcss.config.js`:

```javascript
import autoprefixer from 'autoprefixer';
import rtlcss from 'postcss-rtlcss';

export default {
  plugins: [
    autoprefixer({
      overrideBrowserslist: [
        'last 4 Chrome versions',
        'last 4 Firefox versions',
        'last 4 Edge versions',
        'last 4 Safari versions',
        'last 4 iOS versions',
      ],
    }),
    rtlcss({
      // Options for RTL processing
      ltrPrefix: '[dir="ltr"]',
      rtlPrefix: '[dir="rtl"]',
      bothPrefix: '[dir]',
      prefixType: 'attribute',
      onlyDirection: false,
      fromRTL: false,
    }),
  ],
};
```

### Step 3: Create i18n Configuration

Create `frontend/src/boot/i18n.ts`:

```typescript
import { boot } from 'quasar/wrappers';
import { createI18n } from 'vue-i18n';
import messages from 'src/i18n';

export type MessageLanguages = keyof typeof messages;
export type MessageSchema = typeof messages['en-US'];

declare module 'vue-i18n' {
  export interface DefineLocaleMessage extends MessageSchema {}
  export interface DefineDateTimeFormat {}
  export interface DefineNumberFormat {}
}

const i18n = createI18n({
  locale: 'he', // Default to Hebrew
  fallbackLocale: 'en-US',
  legacy: false, // Use Composition API mode
  messages,
  globalInjection: true,
});

export default boot(({ app }) => {
  app.use(i18n);
});

export { i18n };
```

### Step 4: Create Language Files

Create `frontend/src/i18n/index.ts`:

```typescript
import enUS from './en-US';
import he from './he';

export default {
  'en-US': enUS,
  he: he,
};
```

Create `frontend/src/i18n/en-US/index.ts`:

```typescript
export default {
  common: {
    home: 'Home',
    products: 'Products',
    cart: 'Cart',
    checkout: 'Checkout',
    profile: 'Profile',
    login: 'Login',
    register: 'Register',
    logout: 'Logout',
    search: 'Search',
    loading: 'Loading...',
    error: 'Error',
    success: 'Success',
    cancel: 'Cancel',
    save: 'Save',
    delete: 'Delete',
    edit: 'Edit',
    close: 'Close',
    back: 'Back',
    next: 'Next',
    previous: 'Previous',
    submit: 'Submit',
  },
  nav: {
    home: 'Home',
    allProducts: 'All Products',
    categories: 'Categories',
    cart: 'Cart',
    profile: 'My Account',
    orders: 'My Orders',
    settings: 'Settings',
  },
  products: {
    addToCart: 'Add to Cart',
    buyNow: 'Buy Now',
    outOfStock: 'Out of Stock',
    price: 'Price',
    quantity: 'Quantity',
    total: 'Total',
    description: 'Description',
    specifications: 'Specifications',
    reviews: 'Reviews',
    relatedProducts: 'Related Products',
  },
  cart: {
    yourCart: 'Your Cart',
    empty: 'Your cart is empty',
    subtotal: 'Subtotal',
    shipping: 'Shipping',
    discount: 'Discount',
    total: 'Total',
    checkout: 'Proceed to Checkout',
    continueShopping: 'Continue Shopping',
    remove: 'Remove',
    updateQuantity: 'Update Quantity',
  },
  checkout: {
    shippingAddress: 'Shipping Address',
    billingAddress: 'Billing Address',
    paymentMethod: 'Payment Method',
    orderSummary: 'Order Summary',
    placeOrder: 'Place Order',
    orderConfirmation: 'Order Confirmation',
    thankYou: 'Thank you for your order!',
  },
  auth: {
    email: 'Email',
    password: 'Password',
    confirmPassword: 'Confirm Password',
    forgotPassword: 'Forgot Password?',
    rememberMe: 'Remember me',
    loginTitle: 'Sign In',
    registerTitle: 'Create Account',
    noAccount: "Don't have an account?",
    hasAccount: 'Already have an account?',
    loginWithGoogle: 'Continue with Google',
    loginWithMagicLink: 'Send Magic Link',
  },
  upload: {
    dropzone: 'Drag & drop your images here, or click to select',
    uploading: 'Uploading...',
    processing: 'Processing...',
    editImage: 'Edit Image',
    crop: 'Crop',
    rotate: 'Rotate',
    filters: 'Filters',
    text: 'Add Text',
    save: 'Save Changes',
  },
  footer: {
    about: 'About Us',
    contact: 'Contact',
    terms: 'Terms of Service',
    privacy: 'Privacy Policy',
    copyright: '© {year} Print Company. All rights reserved.',
  },
};
```

Create `frontend/src/i18n/he/index.ts`:

```typescript
export default {
  common: {
    home: 'בית',
    products: 'מוצרים',
    cart: 'עגלה',
    checkout: 'תשלום',
    profile: 'פרופיל',
    login: 'התחברות',
    register: 'הרשמה',
    logout: 'התנתקות',
    search: 'חיפוש',
    loading: 'טוען...',
    error: 'שגיאה',
    success: 'הצלחה',
    cancel: 'ביטול',
    save: 'שמירה',
    delete: 'מחיקה',
    edit: 'עריכה',
    close: 'סגירה',
    back: 'חזרה',
    next: 'הבא',
    previous: 'הקודם',
    submit: 'שליחה',
  },
  nav: {
    home: 'בית',
    allProducts: 'כל המוצרים',
    categories: 'קטגוריות',
    cart: 'עגלה',
    profile: 'החשבון שלי',
    orders: 'ההזמנות שלי',
    settings: 'הגדרות',
  },
  products: {
    addToCart: 'הוסף לעגלה',
    buyNow: 'קנה עכשיו',
    outOfStock: 'אזל מהמלאי',
    price: 'מחיר',
    quantity: 'כמות',
    total: 'סה"כ',
    description: 'תיאור',
    specifications: 'מפרט',
    reviews: 'ביקורות',
    relatedProducts: 'מוצרים דומים',
  },
  cart: {
    yourCart: 'העגלה שלך',
    empty: 'העגלה ריקה',
    subtotal: 'סכום ביניים',
    shipping: 'משלוח',
    discount: 'הנחה',
    total: 'סה"כ',
    checkout: 'המשך לתשלום',
    continueShopping: 'המשך לקנות',
    remove: 'הסר',
    updateQuantity: 'עדכן כמות',
  },
  checkout: {
    shippingAddress: 'כתובת למשלוח',
    billingAddress: 'כתובת לחיוב',
    paymentMethod: 'אמצעי תשלום',
    orderSummary: 'סיכום הזמנה',
    placeOrder: 'בצע הזמנה',
    orderConfirmation: 'אישור הזמנה',
    thankYou: 'תודה על ההזמנה!',
  },
  auth: {
    email: 'אימייל',
    password: 'סיסמה',
    confirmPassword: 'אימות סיסמה',
    forgotPassword: 'שכחת סיסמה?',
    rememberMe: 'זכור אותי',
    loginTitle: 'התחברות',
    registerTitle: 'יצירת חשבון',
    noAccount: 'אין לך חשבון?',
    hasAccount: 'כבר יש לך חשבון?',
    loginWithGoogle: 'המשך עם Google',
    loginWithMagicLink: 'שלח קישור קסם',
  },
  upload: {
    dropzone: 'גרור תמונות לכאן, או לחץ לבחירה',
    uploading: 'מעלה...',
    processing: 'מעבד...',
    editImage: 'עריכת תמונה',
    crop: 'חיתוך',
    rotate: 'סיבוב',
    filters: 'פילטרים',
    text: 'הוסף טקסט',
    save: 'שמור שינויים',
  },
  footer: {
    about: 'אודות',
    contact: 'צור קשר',
    terms: 'תנאי שימוש',
    privacy: 'מדיניות פרטיות',
    copyright: '© {year} חברת הדפסה. כל הזכויות שמורות.',
  },
};
```

### Step 5: Configure Quasar Hebrew Language Pack

Create `frontend/src/boot/quasar-lang.ts`:

```typescript
import { boot } from 'quasar/wrappers';
import { Quasar, Cookies } from 'quasar';

const langList = import.meta.glob('../../node_modules/quasar/lang/(en-US|he).js');

export default boot(async ({ ssrContext }) => {
  const cookies = process.env.SERVER ? Cookies.parseSSR(ssrContext) : Cookies;

  // Get locale from cookie or default to Hebrew
  const langIso = cookies.get('locale') || 'he';

  try {
    const langModule = await langList[
      `../../node_modules/quasar/lang/${langIso}.js`
    ]();
    Quasar.lang.set(langModule.default, ssrContext);
  } catch (err) {
    console.error('Failed to load Quasar language pack:', err);
    // Fallback to Hebrew
    const heLang = await langList['../../node_modules/quasar/lang/he.js']();
    Quasar.lang.set(heLang.default, ssrContext);
  }
});
```

### Step 6: Create RTL Composable

Create `frontend/src/composables/useRtl.ts`:

```typescript
import { computed } from 'vue';
import { useI18n } from 'vue-i18n';
import { useQuasar } from 'quasar';

export function useRtl() {
  const { locale } = useI18n();
  const $q = useQuasar();

  const isRtl = computed(() => locale.value === 'he');
  const dir = computed(() => (isRtl.value ? 'rtl' : 'ltr'));

  const setLocale = (newLocale: string) => {
    locale.value = newLocale;

    // Update document direction
    if (typeof document !== 'undefined') {
      document.documentElement.setAttribute('dir', newLocale === 'he' ? 'rtl' : 'ltr');
      document.documentElement.setAttribute('lang', newLocale);
    }

    // Store in cookie
    $q.cookies.set('locale', newLocale, { path: '/' });
  };

  return {
    isRtl,
    dir,
    locale,
    setLocale,
  };
}
```

### Step 7: Create RTL CSS Overrides

Create `frontend/src/css/rtl-overrides.scss`:

```scss
// RTL-specific overrides that postcss-rtlcss doesn't handle automatically

[dir="rtl"] {
  // Icons that should NOT flip
  .icon-no-flip {
    transform: none !important;
  }

  // Price always LTR for readability
  .price-display {
    direction: ltr;
    unicode-bidi: isolate;
    text-align: right;
  }

  // Phone numbers always LTR
  .phone-number {
    direction: ltr;
    unicode-bidi: isolate;
  }

  // Credit card inputs always LTR
  .credit-card-input {
    direction: ltr;
  }

  // Fix Quasar component specific issues
  .q-field__native {
    text-align: right;
  }

  // Breadcrumbs separator
  .q-breadcrumbs__separator {
    transform: scaleX(-1);
  }
}

// Force LTR for specific elements regardless of page direction
.force-ltr {
  direction: ltr !important;
  unicode-bidi: isolate;
}

// Force RTL for specific elements
.force-rtl {
  direction: rtl !important;
  unicode-bidi: isolate;
}
```

### Step 8: Update quasar.config.js

Add boot files to `frontend/quasar.config.js`:

```javascript
boot: [
  'i18n',
  'quasar-lang',
  // ... other boot files
],
```

### Step 9: Update App.vue for RTL

Update `frontend/src/App.vue`:

```vue
<template>
  <router-view />
</template>

<script setup lang="ts">
import { watch, onMounted } from 'vue';
import { useI18n } from 'vue-i18n';

const { locale } = useI18n();

// Set document direction based on locale
const updateDir = (loc: string) => {
  if (typeof document !== 'undefined') {
    const dir = loc === 'he' ? 'rtl' : 'ltr';
    document.documentElement.setAttribute('dir', dir);
    document.documentElement.setAttribute('lang', loc);
  }
};

onMounted(() => {
  updateDir(locale.value);
});

watch(locale, (newLocale) => {
  updateDir(newLocale);
});
</script>
```

## Files Created
- `frontend/postcss.config.js`
- `frontend/src/boot/i18n.ts`
- `frontend/src/boot/quasar-lang.ts`
- `frontend/src/i18n/index.ts`
- `frontend/src/i18n/en-US/index.ts`
- `frontend/src/i18n/he/index.ts`
- `frontend/src/composables/useRtl.ts`
- `frontend/src/css/rtl-overrides.scss`

## Acceptance Criteria
- [ ] Hebrew translations display correctly
- [ ] Page layout flips to RTL when locale is 'he'
- [ ] Quasar components respect RTL direction
- [ ] Language can be switched dynamically
- [ ] RTL preference persists via cookie
- [ ] Prices and phone numbers remain LTR
- [ ] SSR renders correct direction attribute
