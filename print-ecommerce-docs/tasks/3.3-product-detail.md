# Task 3.3: Product Detail

## Goal
Build product detail page with gallery, options, and pricing.

## Instructions

Create `frontend/src/pages/products/ProductPage.vue`:

```vue
<template>
  <q-page class="q-pa-md">
    <q-breadcrumbs class="q-mb-md">
      <q-breadcrumbs-el :label="$t('nav.home')" to="/" />
      <q-breadcrumbs-el :label="$t('nav.allProducts')" to="/products" />
      <q-breadcrumbs-el :label="productName" />
    </q-breadcrumbs>

    <div v-if="loading" class="row q-col-gutter-lg">
      <div class="col-12 col-md-6"><q-skeleton height="400px" /></div>
      <div class="col-12 col-md-6"><q-skeleton height="400px" /></div>
    </div>

    <div v-else-if="product" class="row q-col-gutter-lg">
      <!-- Gallery -->
      <div class="col-12 col-md-6">
        <ProductGallery :images="product.images" :thumbnail="product.thumbnail" />
      </div>

      <!-- Details -->
      <div class="col-12 col-md-6">
        <h1 class="text-h4 q-mb-sm">{{ productName }}</h1>

        <!-- Price -->
        <div class="q-mb-md">
          <span v-if="isOnSale" class="text-h6 text-strike text-grey-6 q-mr-sm">
            {{ formatPrice(product.base_price) }}
          </span>
          <span class="text-h4 text-primary price-display">
            {{ formatPrice(currentPrice) }}
          </span>
        </div>

        <!-- Short Description -->
        <p class="text-body1 text-grey-7 q-mb-md">{{ shortDescription }}</p>

        <!-- Options -->
        <ProductOptions
          v-model="selectedOptions"
          :options="product.options"
          @update:model-value="calculatePrice"
        />

        <!-- Quantity -->
        <div class="q-my-md">
          <div class="text-subtitle2 q-mb-sm">{{ $t('products.quantity') }}</div>
          <q-input
            v-model.number="quantity"
            type="number"
            :min="product.min_quantity"
            :max="product.max_quantity"
            outlined
            style="max-width: 120px"
          />
          <PriceCalculator
            v-if="product.pricing_tiers?.length"
            :tiers="product.pricing_tiers"
            :quantity="quantity"
            :base-price="currentPrice"
          />
        </div>

        <!-- Add to Cart -->
        <div class="row q-col-gutter-sm q-mt-lg">
          <div class="col-12 col-sm-8">
            <q-btn
              color="primary"
              :label="$t('products.addToCart')"
              icon="shopping_cart"
              class="full-width"
              size="lg"
              @click="handleAddToCart"
            />
          </div>
          <div class="col-12 col-sm-4">
            <q-btn
              outline
              color="primary"
              :label="$t('products.buyNow')"
              class="full-width"
              size="lg"
              @click="handleBuyNow"
            />
          </div>
        </div>

        <!-- Upload Prompt -->
        <div v-if="product.requires_upload" class="q-mt-md">
          <q-banner class="bg-info text-white">
            <template v-slot:avatar>
              <q-icon name="upload" />
            </template>
            {{ $t('products.uploadRequired') }}
          </q-banner>
        </div>
      </div>
    </div>

    <!-- Tabs: Description, Specifications, Reviews -->
    <q-tabs v-model="activeTab" class="q-mt-xl">
      <q-tab name="description" :label="$t('products.description')" />
      <q-tab name="reviews" :label="$t('products.reviews')" />
    </q-tabs>

    <q-tab-panels v-model="activeTab" class="q-mt-md">
      <q-tab-panel name="description">
        <div v-html="description" />
      </q-tab-panel>
      <q-tab-panel name="reviews">
        <ProductReviews :product-id="product?.id" />
      </q-tab-panel>
    </q-tab-panels>
  </q-page>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { useI18n } from 'vue-i18n';
import { useQuasar } from 'quasar';
import { strapiService } from 'src/services/strapi.service';
import { useCartStore } from 'src/stores/cart.store';
import { useRtl } from 'src/composables/useRtl';
import { useSeo } from 'src/composables/useSeo';
import { env } from 'src/utils/env';
import ProductGallery from 'src/components/products/ProductGallery.vue';
import ProductOptions from 'src/components/products/ProductOptions.vue';
import PriceCalculator from 'src/components/products/PriceCalculator.vue';
import ProductReviews from 'src/components/products/ProductReviews.vue';

const route = useRoute();
const router = useRouter();
const $q = useQuasar();
const { t } = useI18n();
const { isRtl } = useRtl();
const cartStore = useCartStore();

const loading = ref(true);
const product = ref<any>(null);
const quantity = ref(1);
const selectedOptions = ref<Record<string, string>>({});
const activeTab = ref('description');

const productName = computed(() =>
  isRtl.value
    ? product.value?.name_he || product.value?.name_en
    : product.value?.name_en
);

const shortDescription = computed(() =>
  isRtl.value
    ? product.value?.short_description_he || product.value?.short_description_en
    : product.value?.short_description_en
);

const description = computed(() =>
  isRtl.value
    ? product.value?.description_he || product.value?.description_en
    : product.value?.description_en
);

const isOnSale = computed(() =>
  product.value?.sale_price && product.value.sale_price < product.value.base_price
);

const currentPrice = computed(() =>
  isOnSale.value ? product.value.sale_price : product.value?.base_price || 0
);

const formatPrice = (price: number) => `${env.currencySymbol}${price.toFixed(2)}`;

const calculatePrice = () => {
  // Recalculate based on selected options
};

const handleAddToCart = () => {
  cartStore.addItem(product.value, quantity.value, selectedOptions.value);
  $q.notify({
    type: 'positive',
    message: t('cart.itemAdded'),
  });
};

const handleBuyNow = () => {
  handleAddToCart();
  router.push({ name: 'cart' });
};

onMounted(async () => {
  try {
    product.value = await strapiService.getProductBySlug(route.params.slug as string);

    if (product.value) {
      useSeo({
        title: productName.value,
        description: shortDescription.value,
        image: product.value.thumbnail?.url,
        type: 'product',
      });
    }
  } finally {
    loading.value = false;
  }
});
</script>
```

## Additional Components to Create
- `ProductGallery.vue` - Image carousel with zoom
- `ProductOptions.vue` - Option selectors
- `PriceCalculator.vue` - Quantity-based pricing display
- `ProductReviews.vue` - Reviews list (Task 6.3)

## Acceptance Criteria
- [ ] Product details load correctly
- [ ] Gallery shows all images
- [ ] Options update price
- [ ] Add to cart works
- [ ] Buy now redirects to cart
- [ ] SEO meta tags set
- [ ] RTL layout correct
